---
layout:     post
title:      深入 Git
subtitle:   《Git 权威指南》读书笔记
date:       2021-05-11
author:     John Mactavish
header-img: img/post-bg-red-dead-swamp.jpg
catalog: true
tags:
     - Git
     - 读书笔记
     
---

## 基本概念与模型

Git 是分布式版本控制系统（Distributed Version Control System），每个用户都能在本地维护自己的版本，
多个用户也能协同开发。下面介绍单用户 Git 的基本概念与模型。

使用 Git 的项目在根目录下会有一个 .git 目录，它是这个版本库的核心。若想备份一个版本库，只需把这个目录拷贝一份。
其典型结构如下：

```
config
description
HEAD
index
hooks/
info/
objects/
refs/
```

description 文件仅供 GitWeb 程序使用；config 文件包含这个项目的配置选项；info 目录包含一个全局性排除（global exclude）文件，用以放置那些不希望被记录在 .gitignore 文件中的忽略模式（ignored patterns）；hooks 目录包含客户端或服务端的钩子脚本（hook scripts）。
剩下的四个条目很重要：HEAD 文件、index 文件和 objects 目录、refs 目录。objects 目录存储所有的对象；refs 目录存储指向对象（分支、远程仓库和标签等）的指针；HEAD 文件指向目前被检出（check out）的分支；index 文件保存暂存区信息。

Git 工作时将项目分为三个区域：工作区、暂存区、版本库。工作区是用户编辑代码的地方，是根目录下除 .git 目录以外的区域。
暂存区用作提交版本库前的缓冲，由 .git 目录的 index 文件保存信息。版本库是大部分 Git 命令起作用的地方，根据参数不同，
一些命令也会同步影响工作区或暂存区。下面介绍底层模型与常用命令的语义时主要基于版本库。

作为一个版本控制系统，Git 通过存储与管理四类对象进行版本控制。它们是数据对象（blob object）、树对象（tree object）、提交对象（commit object）与标签对象（tag object）。前三种保存在 objects 目录下，标签对象处于 refs 目录下，它们都通过基于对象信息生成的哈希值唯一标识。
数据对象用于保存单个文件，包含的信息是文件内容，不包含文件名，这有利于对象共享。树对象类似于文件系统的目录项，
包含了一条或多条记录（tree entry），每条记录含有一个指向数据对象或者子树对象的指针，以及相应的模式、类型、文件名信息。
不难想到，我们可以用一个树对象表示工作区根目录，工作区的子文件、子文件夹可以分别用数据对象、树对象表示，递归地挂载在根树对象下。
工作区的文件结构可能会随时间改变，而版本即是该文件结构对应的对象树的状态在某一时刻的快照。快照用提交对象表示，它包含的信息有：一个指向根树对象的指针，零个、一个或多个指向父提交对象的指针，作者/提交者信息（依照 user.name 和 user.email 配置来设定，外加一个时间戳）以及提交注释（commit message）。显然，数据对象与树对象屏蔽了底层存储的细节，方便存储优化（后面会提到），而提交对象则是版本控制的基础，
很多 Git 命令也是工作在提交对象上的。而在命令中使用哈希值来标识提交对象实在不是一个好主意，它难以记忆，也不包含语义信息。
使用标签对象是一种解决方案。存在两种类型的标签：轻量标签和附注标签。前者仅包含一个标签名以及一个永不移动的指向某个提交对象的指针。
后者增加了一个标签创建者信息、一个日期和一段注释信息，信息更充分，在实际中更加推荐。

refs 目录中存放着指针（或者叫引用），它们是指向对象（主要是提交对象）的。当然，这些概念没有那么泾渭分明，实际上树对象、提交对象不也有指针的语义吗，标签对象更是就在 refs 目录中。一种常用的指针是分支（branch）。虽然它与标签一样指向提交对象。

下面的示例包括三次 Commit，形象地显示了前三种

![git-objects-relation](https://raw.githubusercontent.com/gonearewe/gonearewe.github.io/master/img/post-2021-git-objects-relation.png)


---

> 参考资料：
>
>《Git 权威指南》
>
>[《Pro Git》 by Scott Chacon and Ben Straub](https://git-scm.com/book/zh/v2)


如果你喜欢我的文章，请我吃根冰棒吧  (o゜▽゜)o ☆

![contribution](https://raw.githubusercontent.com/gonearewe/gonearewe.github.io/master/img/contribution.jpg)

> 最后附上 GitHub：<https://github.com/gonearew